generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum User_roles {
  ADMIN
  ALUMNO
  PROFESOR
}

model Usuario {
  matricula String     @id @db.VarChar(7)
  nombre    String     @db.VarChar(30)
  apellidos String     @db.VarChar(30)
  correo    String     @unique @db.VarChar(30)
  password  String     @db.VarChar(100)
  rol       User_roles

  id_grupo String?
  fk_grupo Grupo?  @relation(name: "alumno_grupo", fields: [id_grupo], references: [id])

  fk_grupo_maestro Grupo[]         @relation(name: "maestro_grupo")
  fk_publicaciones Publicaciones[]

  fk_actividad ActividadContestada[]
}

model Grupo {
  id         String  @id @db.VarChar(12)
  id_maestro String
  fk_maestro Usuario @relation(name: "maestro_grupo", fields: [id_maestro], references: [matricula])

  fk_alumnos Usuario[] @relation(name: "alumno_grupo")
}

model Publicaciones {
  id                String   @id @default(uuid())
  contenido         String   @db.VarChar(500)
  id_material       String?  @db.VarChar(38)
  fecha_publicacion DateTime

  id_profesor String
  fk_maestro  Usuario @relation(references: [matricula], fields: [id_profesor])
}

model ActividadContestada {
  id           String   @id @default(uuid())
  fecha        DateTime @db.DateTime()
  aciertos     String   @db.VarChar(10)
  calificacion Float

  id_alumno String  @db.VarChar(38)
  fk_alumno Usuario @relation(references: [matricula], fields: [id_alumno])

  id_actividad String    @db.VarChar(38)
  fk_actividad Actividad @relation(fields: [id_actividad], references: [id])

  @@unique([id_alumno, id_actividad])
}

model Actividad {
  id               String   @id @default(uuid())
  nombre           String   @unique @db.VarChar(38)
  fecha_creacion   DateTime @db.DateTime()
  fecha_activacion DateTime @db.DateTime()
  fecha_limite     DateTime @db.DateTime()
  total_preguntas  Int

  fk_pregunta   Pregunta[]
  fk_contestada ActividadContestada[]
}

model Pregunta {
  id       String @id @default(uuid())
  pregunta String @db.VarChar(150)

  id_actividad String    @db.VarChar(40)
  fk_actividad Actividad @relation(fields: [id_actividad], references: [id])

  fk_respuesta Respuesta[]
}

model Respuesta {
  id         String  @id @default(uuid())
  respuesta  String  @db.VarChar(200)
  esCorrecta Boolean

  id_pregunta String   @db.VarChar(40)
  fk_pregunta Pregunta @relation(fields: [id_pregunta], references: [id])
}
